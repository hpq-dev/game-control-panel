function _post(params) {
    var form = document.createElement("form");
    form.setAttribute("method", 'post');
    form.setAttribute("action", '');
    for (var key in params) {
        if (params.hasOwnProperty(key)) {
            var hiddenField = document.createElement("input");
            hiddenField.setAttribute("type", "hidden");
            hiddenField.setAttribute("name", key);
            hiddenField.setAttribute("value", params[key]);
            form.appendChild(hiddenField);
        }
    }
    document.body.appendChild(form);
    form.submit();
}

var a = window.location.pathname.split("/");
$.ajaxSetup({
    headers: {
        "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content")
    }
});
function b() {
    $.ajax({
        url: _PAGE_URL + "api/recent_actions",
        type: "POST",
        success: function(a) {
            $(".feed-data").html(a),
            $(".iconrefresh").remove()
        }
    })
}
$("._" + a[3]).addClass("active"), $(".refresh").on("click", function() {
    $(".feed-data").html("<center>Loading..</center>"), b()
}), 0 != $(".feed-data").length && b(), 0 != $(".updates").length && $.ajax({
    url: _PAGE_URL + "api/updates",
    type: "POST",
    success: function(a) {
        $(".updates-data").html(a), $(".update-content:not(:first)").slideToggle("slow")
    }
}), $("body").on("click", ".update-title", function() {
    $(this).next().slideToggle("slow")
}),0 != $(".notifications").length && ($.ajax({
    url: _PAGE_URL + "api/notifications",
    type: "POST",
    success: function(a) {
        $(".notifications").html(a)
    }
}), $(".notifications").on("click", function() {
    $.ajax({
        url: _PAGE_URL + "api/notifications/read",
        type: "POST",
        success: function() {
            $(".notify").remove()
        }
    })
}));

$("._locate").click(function () {
    var type = ($(this).attr('class').split(' ').pop());
    var id = ($(this).attr("id"));
    swal('View map', '<center><i class="fa fa-spinner fa-4x fa-spin" style="padding:5px;"></i></center)');
    $.ajax({
        url: _PAGE_URL + "api/locate",
        type: "POST",
        data: {
            type: type, id: id
        },
        success: function (data) {
            var image = JSON.parse(data);
            swal('View map', '<img src="data:image/jpeg;base64,'+image.image+'" style="width:100%;"></img>');
        }
    })
});

var url = document.location.toString();
if (url.match('#')) {
    $('.nav-tabs a[href="#' + url.split('#')[1] + '"]').tab('show');
    window.scrollTo(0, 0);
} 

$('._editem').click(() => {
    $('.nav-tabs a[href="#settings"]').tab('show');
});

$('._cd').click((e) => {
    var a = e.target.parentElement.id;
    swal({
        title: 'Confirmation',
        text: 'Are you sure you want to delete this comment? ',
        type: 'warning',
        showCancelButton: true,
        reverseButtons: true
    }).then((b) => {
        if (b.value) {
            _post({
                _comment_delete: a,
                _token: $('meta[name="csrf-token"]').attr('content')
            });
        }
    });
});

$('._ce').click((e) => {
    // hotfix, thx kroos
    var f = $('<form>');
    var el = $('<input>').attr('class','form-control _efc').attr('id', e.target.parentElement.id).val(e.target.getAttribute('value')).appendTo(f);
    // needs editing
    swal({
        title: 'Edit comment',
        html: el,
        showCancelButton: true,
        reverseButtons: true
    }).then((result) => {
        if(result.value) {
            _post({
                _comment_edit: $('._efc').attr('id'),
                text: $('._efc').val(),
                _token: $('meta[name="csrf-token"]').attr('content')
            });
        }
    });
});